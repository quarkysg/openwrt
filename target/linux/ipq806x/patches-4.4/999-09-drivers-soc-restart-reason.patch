--- a/drivers/soc/qcom/Kconfig	2019-01-04 09:44:00.236573034 +0800
+++ b/drivers/soc/qcom/Kconfig	2019-01-04 09:46:49.855573034 +0800
@@ -50,3 +50,13 @@
 
 	  Say M here if you want to include support for the Qualcomm RPM as a
 	  module. This will build a module called "qcom-smd-rpm".
+
+config QCOM_RESTART_REASON
+	bool "Write restart reason on reboot"
+	depends on ARCH_QCOM
+	help
+	Say y here to enable writing restart reason. This adds a reboot handler
+	to write the restart reason command to distinguish between normal and
+	abnormal reboots. This also registers for panic notification so that
+	magic cookies can be set for download mode.
+	If unsure, say N
--- a/drivers/soc/qcom/Makefile	2019-01-04 09:04:22.559794676 +0800
+++ b/drivers/soc/qcom/Makefile	2019-01-04 09:04:33.597794676 +0800
@@ -3,3 +3,4 @@
 obj-$(CONFIG_QCOM_SMD) +=	smd.o
 obj-$(CONFIG_QCOM_SMD_RPM)	+= smd-rpm.o
 obj-$(CONFIG_QCOM_SMEM) +=	smem.o
+obj-$(CONFIG_QCOM_RESTART_REASON) += restart_reason.o
